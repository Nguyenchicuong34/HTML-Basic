<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noel của Chí Cường</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: linear-gradient(to bottom, #020111 0%, #191b2e 100%); /* Bầu trời đêm sâu hơn */
            font-family: 'Arial', sans-serif;
        }

        #canvas-container {
            width: 100vw;
            height: 100vh;
            display: block;
        }

        #greeting {
            position: absolute;
            bottom: 30px;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px gold, 0 0 20px red;
            pointer-events: none;
            z-index: 10;
        }
        
        #instructions {
            position: absolute;
            top: 10px;
            left: 10px;
            color: rgba(255, 255, 255, 0.4);
            font-size: 11px;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="instructions">Di chuột để xoay cảnh • Lăn chuột để phóng to/nhỏ</div>
    <div id="greeting"> Merry Christmas 2025 </div>
    <div id="canvas-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        let scene, camera, renderer;
        let treeGroup, snowSystem, santaGroup, nameSprite;
        let mouseX = 0, mouseY = 0;
        let ornaments = []; // Mảng chứa đèn để làm hiệu ứng nhấp nháy
        
        const SNOW_COUNT = 2000;
        const snowflakes = [];

        function init() {
            // 1. Scene & Fog
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x020111, 0.0015);

            // 2. Camera
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 15, 50); // Camera xa hơn để thấy cây to

      
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            const ambientLight = new THREE.AmbientLight(0x404040, 1.5); // Sáng hơn chút
            scene.add(ambientLight);

            const dirLight = new THREE.DirectionalLight(0xffffff, 1);
            dirLight.position.set(20, 50, 20);
            dirLight.castShadow = true;
            dirLight.shadow.mapSize.width = 2048;
            dirLight.shadow.mapSize.height = 2048;
            scene.add(dirLight);

            // Đèn màu chiếu vào cây
            const spotLight = new THREE.SpotLight(0xffaa00, 0.8);
            spotLight.position.set(-20, 30, 20);
            scene.add(spotLight);

            // 5. Tạo các đối tượng
            createBigTree();
            createGround();
            createSnow();
            createSanta();
            createNameText("Nguyễn Chí Cường"); // Tạo tên bay lơ lửng

            // Event Listeners
            document.addEventListener('mousemove', onDocumentMouseMove, false);
            window.addEventListener('resize', onWindowResize, false);
            // Thêm zoom
            document.addEventListener('wheel', (event) => {
                camera.position.z += event.deltaY * 0.05;
                camera.position.z = Math.max(20, Math.min(camera.position.z, 80));
            });

            animate();
        }

        // --- HÀM TẠO TÊN 3D (SPRITE) ---
        function createNameText(nameString) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 1024;
            canvas.height = 256;

            // Cấu hình vẽ chữ
            ctx.font = "Bold 80px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            
            // Hiệu ứng bóng đổ chữ (Glow)
            ctx.shadowColor = "#FFD700"; // Màu vàng kim
            ctx.shadowBlur = 20;
            ctx.fillStyle = "#FF0000"; // Chữ màu đỏ
            ctx.fillText(nameString, canvas.width / 2, canvas.height / 2);
            
            // Viền trắng
            ctx.strokeStyle = "white";
            ctx.lineWidth = 3;
            ctx.strokeText(nameString, canvas.width / 2, canvas.height / 2);

            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({ map: texture });
            nameSprite = new THREE.Sprite(material);
            
            // Tăng kích thước sprite
            nameSprite.scale.set(30, 7.5, 1); 
            nameSprite.position.set(0, 32, 0); // Đặt tên cao trên đỉnh cây
            scene.add(nameSprite);
        }

        // --- HÀM TẠO CÂY THÔNG LỚN ---
        function createBigTree() {
            treeGroup = new THREE.Group();

            // Thân cây to
            const trunkGeo = new THREE.CylinderGeometry(3, 4, 10, 16);
            const trunkMat = new THREE.MeshStandardMaterial({ color: 0x3d2817, roughness: 1 });
            const trunk = new THREE.Mesh(trunkGeo, trunkMat);
            trunk.position.y = 5;
            trunk.castShadow = true;
            treeGroup.add(trunk);

            // Các tầng lá (nhiều tầng hơn, to hơn)
            const levels = [
                { r: 16, h: 10, y: 8 },
                { r: 14, h: 9, y: 13 },
                { r: 11, h: 8, y: 17 },
                { r: 9, h: 7, y: 21 },
                { r: 6, h: 6, y: 24 },
                { r: 3, h: 5, y: 27 }
            ];

            const leafMat = new THREE.MeshStandardMaterial({ 
                color: 0x085f20, 
                roughness: 0.7,
                flatShading: true 
            });

            levels.forEach((lv, idx) => {
                const geo = new THREE.ConeGeometry(lv.r, lv.h, 64); // Nhiều cạnh hơn cho mượt
                const mesh = new THREE.Mesh(geo, leafMat);
                mesh.position.y = lv.y;
                mesh.castShadow = true;
                mesh.receiveShadow = true;
                treeGroup.add(mesh);

                // Trang trí đèn và châu
                addDecorations(lv.r, lv.y, lv.h, idx);
            });

            // Ngôi sao lớn
            const starGeo = new THREE.OctahedronGeometry(2, 0);
            const starMat = new THREE.MeshStandardMaterial({ 
                color: 0xffd700, 
                emissive: 0xffaa00, 
                emissiveIntensity: 0.8,
                metalness: 0.8
            });
            const star = new THREE.Mesh(starGeo, starMat);
            star.position.y = 30; // Đỉnh cao nhất
            
            // Đèn tỏa sáng từ ngôi sao
            const starLight = new THREE.PointLight(0xffd700, 1.5, 30);
            star.add(starLight);

            treeGroup.add(star);
            scene.add(treeGroup);
        }

        function addDecorations(radius, y, height, levelIndex) {
            const colors = [0xff0000, 0xffd700, 0x00aaff, 0xffffff, 0xff00ff];
            // Số lượng đèn tăng theo kích thước tầng
            const count = 12 + levelIndex * 4; 

            for(let i=0; i<count; i++) {
                // Xoắn ốc nhẹ
                const angle = (i / count) * Math.PI * 2 + (levelIndex * 0.5);
                const r = radius * 0.85; // Bám sát tán lá
                const decorationY = y - height/2 + 0.5 + (Math.sin(i)*0.5); // Hơi ngẫu nhiên độ cao

                const x = Math.cos(angle) * r;
                const z = Math.sin(angle) * r;

                // Xen kẽ đèn phát sáng và quả châu bóng
                const isLight = Math.random() > 0.4;
                
                const geo = new THREE.SphereGeometry(isLight ? 0.4 : 0.5, 16, 16);
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                const mat = new THREE.MeshStandardMaterial({
                    color: color,
                    metalness: isLight ? 0 : 0.9,
                    roughness: isLight ? 0.1 : 0.1,
                    emissive: isLight ? color : 0x000000,
                    emissiveIntensity: isLight ? 1 : 0
                });

                const mesh = new THREE.Mesh(geo, mat);
                mesh.position.set(x, decorationY, z);
                treeGroup.add(mesh);

                // Nếu là đèn, lưu vào mảng để animate nhấp nháy
                if(isLight) {
                    ornaments.push({ mesh: mesh, baseIntensity: 1, speed: Math.random() * 3 + 1 });
                }
            }
        }

        // --- HÀM TẠO ÔNG GIÀ NOEL ĐƠN GIẢN (KHỐI HÌNH HỌC) ---
        function createSanta() {
            santaGroup = new THREE.Group();

            // Xe trượt tuyết (Thân xe đỏ)
            const sleighGeo = new THREE.BoxGeometry(4, 1.5, 2.5);
            const sleighMat = new THREE.MeshStandardMaterial({ color: 0xcc0000 });
            const sleigh = new THREE.Mesh(sleighGeo, sleighMat);
            santaGroup.add(sleigh);

            // Bao quà (Hình cầu méo màu vàng nâu)
            const bagGeo = new THREE.DodecahedronGeometry(1.5);
            const bagMat = new THREE.MeshStandardMaterial({ color: 0xc2b280 });
            const bag = new THREE.Mesh(bagGeo, bagMat);
            bag.position.set(-1.5, 1.5, 0);
            santaGroup.add(bag);

            // Ông già Noel (Đầu + Mũ + Thân)
            const bodyGeo = new THREE.CylinderGeometry(0.8, 1, 1.5, 8);
            const suitMat = new THREE.MeshStandardMaterial({ color: 0xff0000 });
            const body = new THREE.Mesh(bodyGeo, suitMat);
            body.position.set(1, 1, 0);
            
            const headGeo = new THREE.SphereGeometry(0.6, 16, 16);
            const skinMat = new THREE.MeshStandardMaterial({ color: 0xffccaa }); // Màu da
            const head = new THREE.Mesh(headGeo, skinMat);
            head.position.y = 1.2;
            body.add(head);

            // Mũ
            const hatGeo = new THREE.ConeGeometry(0.6, 1, 16);
            const hatMat = new THREE.MeshStandardMaterial({ color: 0xff0000 });
            const hat = new THREE.Mesh(hatGeo, hatMat);
            hat.position.y = 0.5;
            hat.rotation.x = -0.2;
            head.add(hat);

            santaGroup.add(body);

            // Đặt vị trí ban đầu
            santaGroup.position.set(25, 30, 0); 
            scene.add(santaGroup);
        }

        function createGround() {
            // Sàn tuyết rộng lớn
            const geo = new THREE.PlaneGeometry(200, 200);
            const mat = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.8 });
            const mesh = new THREE.Mesh(geo, mat);
            mesh.rotation.x = -Math.PI / 2;
            mesh.receiveShadow = true;
            scene.add(mesh);
        }

        function createSnow() {
            const geo = new THREE.BufferGeometry();
            const pos = [];
            for(let i=0; i<SNOW_COUNT; i++) {
                let x = Math.random() * 100 - 50;
                let y = Math.random() * 80;
                let z = Math.random() * 100 - 50;
                pos.push(x,y,z);
                snowflakes.push({
                    x: x, y: y, z: z,
                    speed: 0.05 + Math.random() * 0.2,
                    wobble: Math.random() * Math.PI * 2
                });
            }
            geo.setAttribute('position', new THREE.Float32BufferAttribute(pos, 3));
            const mat = new THREE.PointsMaterial({ color: 0xffffff, size: 0.4, transparent: true, opacity: 0.8 });
            snowSystem = new THREE.Points(geo, mat);
            scene.add(snowSystem);
        }

        function onDocumentMouseMove(event) {
            mouseX = (event.clientX - window.innerWidth / 2) * 0.05;
            mouseY = (event.clientY - window.innerHeight / 2) * 0.05;
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.001;

            // 1. Xoay cây nhẹ
            if(treeGroup) treeGroup.rotation.y += 0.003;

            // 2. Ông già Noel bay vòng quanh (Quỹ đạo elip trên cao)
            if(santaGroup) {
                santaGroup.position.x = Math.sin(time * 0.5) * 30;
                santaGroup.position.z = Math.cos(time * 0.5) * 30;
                santaGroup.position.y = 35 + Math.sin(time) * 2; // Nhấp nhô
                santaGroup.lookAt(0, 35, 0); // Hướng vào giữa (hoặc hướng theo chiều bay)
                santaGroup.rotation.y += Math.PI; // Chỉnh lại hướng xe
            }

            // 3. Hiệu ứng tên (Nhấp nhô nhẹ)
            if(nameSprite) {
                nameSprite.position.y = 34 + Math.sin(time * 2) * 0.5;
            }

            // 4. Đèn nhấp nháy
            ornaments.forEach(orn => {
                const flicker = Math.sin(time * orn.speed) * 0.5 + 0.5; // 0 -> 1
                orn.mesh.material.emissiveIntensity = flicker + 0.2;
            });

            // 5. Tuyết rơi
            const positions = snowSystem.geometry.attributes.position.array;
            for(let i=0; i<SNOW_COUNT; i++) {
                let flake = snowflakes[i];
                flake.y -= flake.speed;
                flake.x += Math.sin(time + flake.wobble) * 0.02;
                
                if(flake.y < 0) {
                    flake.y = 80;
                    flake.x = Math.random() * 100 - 50;
                    flake.z = Math.random() * 100 - 50;
                }
                positions[i*3] = flake.x;
                positions[i*3+1] = flake.y;
                positions[i*3+2] = flake.z;
            }
            snowSystem.geometry.attributes.position.needsUpdate = true;

            // 6. Camera mượt mà
            camera.position.x += (mouseX - camera.position.x) * 0.02;
            camera.position.y += (-mouseY + 20 - camera.position.y) * 0.02;
            camera.lookAt(0, 15, 0); // Nhìn vào giữa thân cây

            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>